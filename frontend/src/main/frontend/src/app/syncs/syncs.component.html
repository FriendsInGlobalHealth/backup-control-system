<!--
 Copyright (C) 2014-2018, Friends in Global Health, LLC
 All rights reserved.
 @author Damasceno Lopes
-->

<br>
<h5 class="light">{{ "syncsfound" | translate }}
</h5>

<form materialize [formGroup]="form">
  <div class="row">
    <div class="col s12 l2 m2">
      <mz-select-container>
        <select mz-select mz-validation required id="district" label="{{ 'district' | translate }}" formControlName="district"
          (change)="search()" [disabled]="disabled2==true">
          <option value="all" selected>Todos Distritos</option>
          <option *ngFor="let district of alldistricts" [value]="district.districtId">{{ district.fullName }}</option>
        </select>
      </mz-select-container>
    </div>

    <div class="col s12 l2 m2">
      <mz-select-container>
        <select mz-select mz-validation required id="server" label="{{ 'servername' | translate }}" formControlName="server"
          (change)="search()" [disabled]="disabled1==true">
          <option value="all" selected>Todos Servidores</option>

          <optgroup *ngFor="let d of allservers" [label]="d.district">
            <option *ngFor="let server of d.servers" [value]="server.serverId">{{ server.name }}</option>
          </optgroup>
        </select>
      </mz-select-container>
    </div>

  </div>

  <div class="row" style="margin-top: -20px;">

    <div class="col s6 l2 m2">
      <mz-datepicker-container>
        <input mz-datepicker label="{{ 'sync_from' | translate }}" [options]="options" formControlName="start_from"
          type="date" (change)="search()" />
      </mz-datepicker-container>
    </div>

    <div class="col s6 l2 m2">
      <mz-datepicker-container>
        <input mz-datepicker label="{{ 'sync_until' | translate }}" [options]="options" formControlName="start_until"
          type="date" (change)="search()" />
      </mz-datepicker-container>
    </div>
    <div class="col s12 m8 l8" style="margin-top: -15px;">
      <ul class="pagination valign-center" *ngIf="isHidden=='hide'">

        <span class="page-size">{{ 'itenspage' | translate }}:</span> &nbsp;&nbsp;
        <mz-select-container style="width: 50px;">
          <select mz-select id="pageSize" [(ngModel)]="pageSize" [ngModelOptions]="{standalone: true}" (change)="searchSize()">
            <option value="10" selected>10</option>
            <option value="25">25</option>
<option value="50">50</option>
            <option value="100">100</option>
          </select>
        </mz-select-container>


        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="page-size">{{range}} {{ "of" | translate }} {{total}}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <li *ngIf="first=='disabled'" class="disabled"><i class="material-icons icon-grey">chevron_left</i></li>
        <li *ngIf="first==''" class="waves-effect"><a (click)="getPage(previous)"><i class="material-icons">chevron_left</i></a></li>
        <li *ngIf="last=='disabled'" class="disabled"><i class="material-icons icon-grey">chevron_right</i></li>
        <li *ngIf="last==''" class="waves-effect"><a (click)="getPage(next)"><i class="material-icons">chevron_right</i></a></li>

      </ul>
    </div>
  </div>
</form>

<div class="col s12 card" style="margin-top: -20px;">
  <div class="progress {{isHidden}}" style="margin-top: 35px; margin-bottom: 0;">
    <div class="indeterminate"></div>
  </div>
  <table class="bordered responsive-table highlight">
    <thead>
      <tr>
        <th>{{ "district" | translate }} / {{ "servername" | translate }}</th>
        <th>{{ "sync_time" | translate }}</th>
        <th>{{ "duration" | translate }}</th>
        <th>{{ "initial_state" | translate }}</th>
        <th>{{ "final_state" | translate }}</th>
        <th>{{ "updatedon" | translate }}</th>
        <th></th>
      </tr>
    </thead>
    <tbody  *ngIf="isHidden=='hide'">
      <tr  style="line-height: 15px;" *ngFor="let sync of syncs">
        <td>{{ sync.district.name }} / {{ sync.server.name }}</td>
       <td>
          {{getSyncTimeline(sync.startTime,sync.endTime)}}
        </td>

        <td>
          {{getSyncDuration(sync.startTime,sync.endTime)}}
        </td>
        <td>
          <span style="font-size: 13px;color:rgb(121, 120, 120);">{{ sync.startItemsToSend }} {{"items_to_s" |translate
          }} </span>
        <br>
        <span style="font-size: 13px;color:rgb(121, 120, 120);">{{ sync.startItemsToReceive }} {{"items_to_r"
          |translate}}</span>
        </td>
        <td *ngIf="getSyncStatus(sync.startTime,sync.endTime)=='complete'">
          <span *ngIf="sync.endItemsToSend==0&&sync.endItemsToReceive==0" class='green-text text-darken-3"'>{{'synced' | translate}}</span>
          <span *ngIf="sync.endItemsToSend>0||sync.endItemsToReceive>0">
            <span style="font-size: 13px;color:rgb(121, 120, 120);">{{ sync.endItemsToSend }} {{"items_to_s" |translate
              }} </span>
            <br>
            <span style="font-size: 13px;color:rgb(121, 120, 120);">{{ sync.endItemsToReceive }} {{"items_to_r"
              |translate}}</span>
          </span>
        </td>
        <td *ngIf="getSyncStatus(sync.startTime,sync.endTime)=='progress'&&getSyncExpires(sync.startTime)==false">
          <span style="float: left;text-align: center; margin-left: 0px; height: 15;" class='new badge orange' data-badge-caption="EM PROGRESSO"></span>
          <div class="progress" style="width: 99px; margin-top: -7px;">
            <div class="indeterminate"></div>
          </div>
        </td>
        <td *ngIf="getSyncStatus(sync.startTime,sync.endTime)=='progress'&&getSyncExpires(sync.startTime)==true">
          <span *ngIf="sync.endItemsToSend==0&&sync.endItemsToReceive==0" class='red-text text-darken-3"'>{{'not_concluded' | translate}}</span>
        </td>
        <td>{{ sync.dateUpdated | date: 'dd/MM/yyyy' }}</td>
        <td>

          <a mz-tooltip tooltip="{{'details' | translate}}" [position]="'top'" [html]="false" [delay]="100" (click)="setSync(sync.uid)"
            (click)="basicModal2.openModal()" [routerLink]="">
            <i *ngIf="getOccurence(sync.uid)==''" class="material-icons icon-green">info</i>
            <i *ngIf="getOccurence(sync.uid)!=''" class="material-icons icon-red">info</i>
          </a>
          &nbsp;
          <a *ngIf="(ROLE_SIS||ROLE_ODMA)&&getSyncExpires(sync.startTime)==false" mz-tooltip tooltip="{{'edit' | translate}}"
            [position]="'top'" [html]="false" [delay]="100" [routerLink]="['/syncs', sync.uid]">
            <i class="material-icons icon-orange">mode_edit</i>
          </a>
          <a *ngIf="(ROLE_SIS||ROLE_ODMA)&&getSyncExpires(sync.startTime)==true" mz-tooltip tooltip="{{'cant_edit_sync' | translate}}"
            [position]="'top'" [html]="false" [delay]="100">
            <i class="material-icons icon-orange " style="color:lightgrey;">mode_edit</i>
          </a>

        </td>
      </tr>
    </tbody>

  </table>
</div>
<ul class="pagination valign-center" *ngIf="isHidden=='hide'">

  <span class="page-size">{{ 'itenspage' | translate }}:</span> &nbsp;&nbsp;
  <mz-select-container style="width: 50px;">
    <select mz-select id="pageSize" [(ngModel)]="pageSize" [ngModelOptions]="{standalone: true}" (change)="searchSize()">
      <option value="10" selected>10</option>
      <option value="25">25</option>
<option value="50">50</option>
      <option value="100">100</option>
    </select>
  </mz-select-container>


  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="page-size">{{range}} {{ "of" | translate }} {{total}}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <li *ngIf="first=='disabled'" class="disabled"><i class="material-icons icon-grey">chevron_left</i></li>
  <li *ngIf="first==''" class="waves-effect"><a (click)="getPage(previous)"><i class="material-icons">chevron_left</i></a></li>
  <li *ngIf="last=='disabled'" class="disabled"><i class="material-icons icon-grey">chevron_right</i></li>
  <li *ngIf="last==''" class="waves-effect"><a (click)="getPage(next)"><i class="material-icons">chevron_right</i></a></li>

</ul>
<!--
<ul class="pagination" *ngIf="isHidden==''">
  {{ "loading" | translate }}
</ul>
-->
<mz-modal #basicModal2 [fixedFooter]="true">
  <mz-modal-header>
    <h4>{{ "syncdetails" | translate }}</h4>
  </mz-modal-header>
  <mz-modal-content>

    <div class="row" style="margin-top: -11px;">
      <div class="col s12">
        <h5 class="light">{{sync.server.name}}</h5>
      </div>
    </div>

    <div class="row" style="margin-top: -11px;">
      <div class="col s12 l2 m2">{{ "district" | translate }}:</div>
      <div class="col s12 l10 m10">{{sync.district.name}}</div>
    </div>
    <div class="row" style="margin-top: -11px;">
      <div class="col s12 l2 m2">{{ "sync_time" | translate }}:</div>
      <div class="col s12 l10 m10">{{getSyncTimeline(sync.startTime,sync.endTime)}}</div>
    </div>

    <div class="row" style="margin-top: -11px;">
      <div class="col s12 l2 m2">{{ "duration" | translate }}:</div>
      <div class="col s12 l10 m10" *ngIf="getSyncStatus(sync.startTime,sync.endTime)=='progress'&&getSyncExpires(sync.startTime)==false"><span style="float: left;text-align: center; margin-left: 0px;" class='new badge orange' data-badge-caption="EM PROGRESSO"></span></div>
      <div class="col s12 l10 m10" *ngIf="getSyncStatus(sync.startTime,sync.endTime)=='progress'&&getSyncExpires(sync.startTime)==true"><span *ngIf="sync.endItemsToSend==0&&sync.endItemsToReceive==0" class='red-text text-darken-3"'>{{'not_concluded' | translate}}</span></div>
      <div class="col s12 l10 m10" *ngIf="getSyncStatus(sync.startTime,sync.endTime)=='complete'">{{getSyncDuration(sync.startTime,sync.endTime)}}</div>
    </div>

    <div class="row" style="margin-top: -11px;">
      <div class="col s12 l2 m2">{{ "items_onstart" | translate }}:</div>
      <div class="col s12 l10 m10">{{ sync.startItemsToSend }} {{ "items_send" | translate }}
        <br>{{ sync.startItemsToReceive }} {{ "items_receive" | translate }}</div>
    </div>

    <div class="row" style="margin-top: -11px;" *ngIf="sync.endTime!=null">
      <div class="col s12 l2 m2">{{ "items_onend" | translate }}:</div>
      <div class="col s12 l10 m10">{{ sync.endItemsToSend }} {{ "items_send" | translate }}
        <br>{{ sync.endItemsToReceive }} {{ "items_receive" | translate }}</div>
    </div>

    <div class="row" style="margin-top: -11px;">
      <div class="col s12 l2 m2"></div>
      <div class="col s12 l10 m10">
        <input type="checkbox" id="update_finished" checked="{{sync.syncError==true?'checked':''}}" onclick="return false;" />
        <label for="update_finished">{{ "sync_error_desc" | translate }}</label>
      </div>
    </div>

    <div class="row" style="margin-top: -11px;">
      <div class="col s12 l2 m2"></div>
      <div class="col s12 l10 m10">
        <input type="checkbox" id="serverfault" checked="{{sync.serverFault==true?'checked':''}}" onclick="return false;" />
        <label for="serverfault">{{ "serverfault" | translate }}</label>
      </div>
    </div>

    <div class="row" style="margin-top: -11px;">
      <div class="col s12 l2 m2"></div>
      <div class="col s12 l10 m10">
        <input type="checkbox" id="laptopfault" checked="{{sync.laptopFault==true?'checked':''}}" onclick="return false;" />
        <label for="laptopfault">{{ "laptopfault" | translate }}</label>
      </div>
    </div>

    <div class="row" style="margin-top: -11px;">
      <div class="col s12 l2 m2"></div>
      <div class="col s12 l10 m10">
        <input type="checkbox" id="powercut" checked="{{sync.powerCut==true?'checked':''}}" onclick="return false;" />
        <label for="powercut">{{ "powercut" | translate }}</label>
      </div>
    </div>

    <div class="row" style="margin-top: -11px;" *ngIf="sync.observation!=null">
      <div class="col s12 l2 m2">{{ "obs_district" | translate }}:</div>
      <div class="col s12 l10 m10">{{sync.observation}}</div>
    </div>
    <div class="row" style="margin-top: -11px;" *ngIf="sync.observationHis!=null">
      <div class="col s12 l2 m2">{{ "obs_his" | translate }}:</div>
      <div class="col s12 l10 m10">{{sync.observationHis}}</div>
    </div>

    <div class="row" style="margin-top: -11px;">
      <div class="col s12 l2 m2">{{ "createdby" | translate }}:</div>
      <div class="col s12 l10 m10">{{sync.createdBy.personName}} - {{ sync.dateCreated | date:'dd/MM/yyyy HH:mm' }}</div>
    </div>
    <div class="row" *ngIf="sync.updatedBy!=null" style="margin-top: -11px;">
      <div class="col s12 l2 m2">{{ "updatedby" | translate }}:</div>
      <div class="col s12 l10 m10">{{sync.updatedBy.personName}} - {{ sync.dateUpdated | date:'dd/MM/yyyy HH:mm' }}</div>
    </div>

    <div class="row" style="margin-top: -11px;">
      <div class="col s12 l2 m2"></div>
      <div class="col s12 l10 m10">
        <span style="color:lightgrey;">{{sync.uid}}</span>
      </div>
    </div>
  </mz-modal-content>
  <mz-modal-footer>
    <button mz-button [flat]="true" mz-modal-close>{{ "close" | translate }}</button>
  </mz-modal-footer>
</mz-modal>


<div class="fixed-action-btn" style="bottom: 20px; right: 20px;">
  <a class="btn-floating  btn-large green">
    <i class="material-icons">more_vert</i>
  </a>
  <ul>
      <li>
          <a mz-tooltip tooltip="{{'downloadlist' | translate}} Excel" [position]="'left'" [html]="false" [delay]="100" (click)="printListExcel()"
            class="btn-floating  waves-effect waves-light  orange">
            <i class="material-icons">file_download</i>
          </a>
        </li>
    <li>
      <a mz-tooltip tooltip="{{'downloadlist' | translate}} PDF" [position]="'left'" [html]="false" [delay]="100" (click)="printList()"
        class="btn-floating  waves-effect waves-light  orange">
        <i class="material-icons">file_download</i>
      </a>
    </li>
    <li *ngIf="ROLE_SIS||ROLE_ODMA">
      <a mz-tooltip [tooltip]="'Registar nova Sincronização'" [position]="'left'" [html]="false" [delay]="100"
        routerLink="/syncs/new" class="btn-floating  waves-effect waves-light  blue">
        <i class="material-icons">add</i>
      </a>
    </li>
  </ul>
</div>